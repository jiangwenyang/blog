<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://jiangwenyang.com</id>
    <title>Jiang Wenyang's Blog</title>
    <updated>2022-03-28T05:19:04.976Z</updated>
    <generator>Feed for Node.js</generator>
    <author>
        <name>Jiang Wenyang</name>
        <email>u19950930@gmail.com</email>
        <uri>https://jiangwenyang.com</uri>
    </author>
    <link rel="alternate" href="https://jiangwenyang.com"/>
    <link rel="self" href="https://jiangwenyang.com/atom"/>
    <subtitle>Jiang Wenyang's Blog</subtitle>
    <logo>https://jiangwenyang.com/logo.svg</logo>
    <icon>https://jiangwenyang.com/favicon.ico</icon>
    <rights>All rights reserved 2022, Jiang Wenyang</rights>
    <entry>
        <title type="html"><![CDATA[ä¸€ä¸ªçœŸå®çš„Vue CLIé¡¹ç›®è¿ç§»åˆ°vite]]></title>
        <id>https://jiangwenyang.com/posts/ä¸€ä¸ªçœŸå®çš„vue-clié¡¹ç›®è¿ç§»åˆ°vite</id>
        <link href="https://jiangwenyang.com/posts/ä¸€ä¸ªçœŸå®çš„vue-clié¡¹ç›®è¿ç§»åˆ°vite"/>
        <updated>2021-09-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[
## æ˜¯è°ï¼Ÿå«ä»€ä¹ˆï¼Ÿæ¥è‡ªå“ªé‡Œï¼Ÿè¦å»å¾€é‚£é‡Œï¼Ÿ

å…ˆæ¥å›ç­”çµé­‚æ‹·é—®ã€‚æˆ‘ä»¬åŸæœ‰çš„é¡¹ç›®æ˜¯ä¸€ä¸ªä½¿ç”¨ Vue CLI ç”Ÿæˆçš„ vue2 é¡¹ç›®ï¼Œé¡¹ç›®æ•´ä½“ä¸Šæ˜¯æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜çš„ï¼Œä½†æ˜¯éšç€æ¨¡å—çš„ä¸æ–­å¢å¤šï¼ŒVue CLI åŸºäº Webpack æ„å»ºé€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼Œå¼€å‘ä½“éªŒä¸Šæ¯”è¾ƒå·®ï¼Œä¸ºäº†å‡å°‘æŠ“ç‹‚æ—¶é—´ï¼Œæˆ‘ä»¬å°†ç›®å…‰è½¬å‘äº†å·ç§°å¾ˆå¿«çš„ Viteã€‚

åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæ¥çœ‹åŸæœ¬çš„é¡¹ç›®ç»“æ„ï¼š

```
â”œâ”€â”€ .browserslistrc
â”œâ”€â”€ .editorconfig
â”œâ”€â”€ .env.development // ç¯å¢ƒå˜é‡ï¼Œä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶åŒ
â”œâ”€â”€ .env.development.local
â”œâ”€â”€ .env.pre
â”œâ”€â”€ .env.production
â”œâ”€â”€ .env.si
â”œâ”€â”€ .env.test
â”œâ”€â”€ .eslintignore
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .npmrc
â”œâ”€â”€ .nvmrc
â”œâ”€â”€ .prettierignore
â”œâ”€â”€ .prettierrc.js
â”œâ”€â”€ .stylelintignore
â”œâ”€â”€ .stylelintrc.js
â”œâ”€â”€ README.md
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ build/
â”œâ”€â”€ config/ ä¸€äº›é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå¦‚ä»£ç†é…ç½®ç­‰
â”œâ”€â”€ dist/ æ„å»ºäº§ç‰©
â”œâ”€â”€ doc/ å¼€å‘æ–‡æ¡£
â”œâ”€â”€ jsconfig.json
â”œâ”€â”€ mock/
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ public/
â”œâ”€â”€ src/ ä¸šåŠ¡ç›¸å…³
â”œâ”€â”€ tests/
â”œâ”€â”€ vue.config.js // Vue CLIé…ç½®
â””â”€â”€ yarn.lock
```

## å¥½å¥½çš„ä¸ºä»€ä¹ˆè¦è¿ç§»ï¼Ÿ

è¿ç§»çš„ç›®çš„ä¸»è¦æ˜¯æ„å»ºé€Ÿåº¦ä¸Šçš„å·®åˆ«ï¼Œé™¤æ­¤ä¹‹å¤– Vite ä¹Ÿæœ‰ä¸€äº›å…¶ä»–çš„ä¼˜åŠ¿ã€‚

- æ„å»ºé€Ÿåº¦

  Vite ç›¸æ¯” Vue CLI æœ€æ˜¾è‘—çš„ä¼˜åŠ¿åº”è¯¥å°±æ˜¯æ„å»ºé€Ÿåº¦äº†ï¼ŒVite åŸºäº esbuild é¢„æ„å»ºä¾èµ–ï¼Œå› æ­¤ä¼šå¿«å¾ˆå¤šï¼Œå¼€å‘ä½“éªŒä¼šæ›´å¥½ã€‚

  > Vite çš„å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒæ„å»ºç›®å‰æœ‰æ‰€åŒºåˆ«ï¼Œå¼€å‘ç¯å¢ƒå› ä¸ºç›´æ¥ä½¿ç”¨åŸç”Ÿ ESM ä¸éœ€è¦æ‰“åŒ…ï¼Œè€Œç”Ÿäº§ç¯å¢ƒæ‰“åŒ…é‡‡ç”¨äº† Rollup

- éšè—æŠ€æœ¯ç»†èŠ‚

  å‘ƒï¼Œè¿™ä¸€ç‚¹ï¼Œå…¶å® vite å’Œ Vue CLI æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ã€‚ã€‚

- æŠ˜è…¾ï¼Œå°è¯•æ–°çš„å·¥å…·

  æ¯•ç«Ÿæ˜¯æ–°çš„å·¥å…·ï¼Œå°è¯•ä¸€ä¸‹ï¼Œå¹¶ä¸” Vue ç¤¾åŒºç›®å‰ä¹Ÿæ˜¯åœ¨æ¨åŠ¨çš„ã€‚

## åƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹

ä¸‡äº‹å¼€å¤´éš¾ï¼Œæ—¢ç„¶è¿ç§»çš„ Flag å·²ç»ç«‹äº†ï¼Œåªèƒ½ç¡¬ç€å¤´çš®ä¸Šäº†ã€‚è®©æˆ‘ä»¬å…ˆç®€å•çœ‹ä¸€é Vite çš„å®˜æ–¹æ–‡æ¡£ï¼Œæ–‡æ¡£å»¶ç»­äº† Vue å®˜æ–¹æ–‡æ¡£ç®€æ´æ¸…æ™°çš„ä¼˜ç‚¹ï¼ŒåŸºæœ¬ä¸Šç®€å•çœ‹ä¸€éå°±å¯¹ Vite æ¯”è¾ƒäº†è§£äº†ï¼Œå…·ä½“ç»†èŠ‚ä¸æ¯”è¿‡åˆ†æ·±ç©¶ã€‚çœ‹å®Œæ–‡æ¡£å¾ˆå®¹æ˜“å‘ç°å’Œ Vue CLI çš„ä¸€äº›çº¦å®šä¸Šçš„åŒºåˆ«ï¼Œå¯¹äºè¿™éƒ¨åˆ†æ˜¯å¿…é¡»ä¿®æ”¹ä»£ç çš„ï¼Œä¸‹é¢å¼€å§‹è¿ç§»

### é¦–å…ˆä¸¢æ‰å†å²åŒ…è¢±ï¼Œç§»é™¤ Vue CLI è½»è£…ä¸Šé˜µ

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆç§»é™¤æ‰€æœ‰å’Œ Vue CLI ç›¸å…³çš„ä¾èµ–ä»¥åŠé…ç½®

- åœ¨ `package.json` çš„ä¾èµ–ä¸­æœç´¢ `vue-cli` å…³é”®è¯ï¼Œç„¶åç§»é™¤ç›¸å…³ä¾èµ–ã€‚

- å°† script ä¸­çš„å¯åŠ¨è„šæœ¬æ”¹ä¸º Vite å¯¹åº”çš„å¯åŠ¨è„šæœ¬

  å°†åŸæœ¬çš„å¯åŠ¨è„šæœ¬

  ```json
  {
    "scripts": {
      "dev": "vue-cli-service serve --open",
      "build": "vue-cli-service build --mode development"
    }
  }
  ```

  æ”¹ä¸º

  ```json
  {
    "scripts": {
      "dev": "vite",
      "build": "vite build",
      "serve": "vite preview"
    }
  }
  ```

### ç„¶åå‰”ä¸ªç‰™ï¼Œåšäº›â€œå°æ”¹åŠ¨â€

æˆ‘ä»¬ä¸Šé¢è¯´åˆ° Vite å’Œ Vue CLI åœ¨éƒ¨åˆ†çº¦å®šä¸Šçš„ä¸åŒï¼Œéœ€è¦å¯¹ä»£ç åšä¸€äº›å°æ”¹åŠ¨

#### å…¥å£ä¸åŒ

Vue CLI é»˜è®¤å…¥å£ä¸º`src/main.js`ï¼Œè€Œ Vite çš„é»˜è®¤å…¥å£åˆ™æ˜¯ index.html

ç›´æ¥å¼•ç”¨å®˜æ–¹æ–‡æ¡£ï¼š

> Vite å°† `index.html` è§†ä¸ºæºç å’Œæ¨¡å—å›¾çš„ä¸€éƒ¨åˆ†ã€‚Vite è§£æ `<script type="module" src="...">` ï¼Œè¿™ä¸ªæ ‡ç­¾æŒ‡å‘ä½ çš„ JavaScript æºç ã€‚ç”šè‡³å†…è”å¼•å…¥ JavaScript çš„ `<script type="module">` å’Œå¼•ç”¨ CSS çš„ `<link href>` ä¹Ÿèƒ½åˆ©ç”¨ Vite ç‰¹æœ‰çš„åŠŸèƒ½è¢«è§£æã€‚å¦å¤–ï¼Œ`index.html` ä¸­çš„ URL å°†è¢«è‡ªåŠ¨è½¬æ¢ï¼Œå› æ­¤ä¸å†éœ€è¦ `%PUBLIC_URL%` å ä½ç¬¦äº†ã€‚

å› æ­¤æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¿®æ”¹åŸæœ‰çš„å…¥å£

å°† `public/index.html`

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta name="description" content="" />
    <meta name="Keywords" content="" />
    <link rel="icon" href="<%= BASE_URL %>favicon.ico" />
    <title><%= webpackConfig.name %></title>
  </head>
  <body>
    <noscript>
      <strong>æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScriptï¼ï¼ï¼</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
```

ç§»åŠ¨åˆ°æ ¹ç›®å½•ä¸‹`index.html` ï¼Œå¹¶åšä¿®æ”¹

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta name="description" content="" />
    <meta name="Keywords" content="" />
    <link rel="icon" href="./favicon.ico" />
    <title>XXX</title>
  </head>
  <body>
    <noscript>
      <strong>æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScriptï¼ï¼ï¼</strong>
    </noscript>
    <div id="app"></div>
    <!-- Viteå°†è‡ªåŠ¨è§£æä¸‹é¢çš„jsæ–‡ä»¶ -->
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
```

#### ç¯å¢ƒå˜é‡ä¸åŒ

Vue CLI çš„ç¯å¢ƒå˜é‡å’Œ Vite çš„ç¯å¢ƒå˜é‡åŠ è½½éƒ½æ˜¯é€šè¿‡ [dotenv](https://github.com/motdotla/dotenv) æ¥å®ç°çš„ï¼Œå› æ­¤åœ¨æ–‡ä»¶å‘½åçº¦å®šä¸Šæ˜¯ä¸€è‡´çš„ã€‚ä½†å…·æœ‰ä»¥ä¸‹ä¸¤ç‚¹ä¸åŒï¼š

- æš´éœ²æ–¹å¼

  - Vue CLI ä¸­çº¦å®šåªæœ‰ `NODE_ENV`ã€`BASE_URL` å’Œä»¥`VUE_APP_` å¼€å¤´çš„å˜é‡è¢«æš´éœ²å‡ºæ¥ã€‚

  - Vite ä¸­åˆ™çº¦å®šå¯ä»¥è®¿é—® `MODE` ï¼ˆåº”ç”¨è¿è¡Œçš„æ¨¡å¼ development|productionï¼‰ ã€`BASE_URL` ã€`PROD` ï¼ˆæ˜¯å¦è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼‰ã€`DEV` ï¼ˆæ˜¯å¦è¿è¡Œåœ¨å¼€å‘ç¯å¢ƒï¼‰ä»¥åŠä»¥ `VITE_` å¼€å¤´çš„ç¯å¢ƒå˜é‡ã€‚

- è®¿é—®æ–¹å¼

  - Vue CLI é€šè¿‡`process.env` æ¥è®¿é—®

  - Vite é€šè¿‡ `import.meta.env` æ¥è®¿é—®

ç”±äºä»¥ä¸Šçš„ä¸¤ç‚¹ä¸åŒï¼Œè¿ç§»æ—¶æˆ‘ä»¬å°±éœ€è¦ï¼š

- å°†åŸæœ¬ä»¥ `VUE_APP_` å¼€å¤´çš„ç¯å¢ƒå˜é‡ç»Ÿä¸€æ›¿æ¢ä¸ºä»¥ `VITE_` å¼€å¤´ï¼›æˆ–è€…å¯é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ `vite.config.js` çš„ [envPrefix](https://cn.vitejs.dev/config/index.html#envprefix) è¿›è¡Œé…ç½®ï¼Œç›´æ¥é…ç½®ä¸º `VUE_APP_` åˆ™ä¸éœ€è¦å¯¹åŸæœ‰ç¯å¢ƒå˜é‡åç§°è¿›è¡Œä¿®æ”¹ã€‚(é…ç½®æ–‡ä»¶çš„åˆ›å»ºä¸‹é¢å°†ä¼šæåˆ°)
- å°† `process.env` ç»Ÿä¸€æ›¿æ¢ä¸º `import.meta.env`ã€‚

#### ä¸èƒ½å¿½ç•¥è‡ªå®šä¹‰å¯¼å…¥ç±»å‹æ‰©å±•åï¼ˆå¦‚`.vue`ï¼‰

åœ¨ Vue CLI ä¸­ï¼Œé»˜è®¤æˆ‘ä»¬å¯ä»¥ä¸å†™`.vue`æ‰©å±•åè¿›è¡Œå¯¼å…¥

```js
import App from "./App";
```

ä½†æ˜¯åœ¨ Vite ä¸­ï¼Œ**ä¸å»ºè®®**ï¼ˆå®æµ‹è¿˜æ˜¯å¯ä»¥é…ç½®çš„ï¼‰å¿½ç•¥è‡ªå®šä¹‰æ‰©å±•åï¼Œå› ä¸ºä¼šå½±å“ IDE å’Œç±»å‹æ”¯æŒã€‚å› æ­¤éœ€è¦å®Œæ•´ä¹¦å†™

```js
import App from "./App.vue";
```

> éè‡ªå®šä¹‰ç±»å‹çš„æ‰©å±•åå¯ä»¥é€šè¿‡é…ç½®é¡¹ ` resolve.extensions` æ¥è¿›è¡Œé…ç½®ï¼Œé»˜è®¤ä¸º `['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json']`

### å‡ºæ¥å§ä½ ï¼ŒVite

åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŸºæœ¬çš„ä¿®æ”¹ä»¥åŠå®Œæˆï¼Œæˆ‘ä»¬å¼€å§‹å¼•å…¥ Viteã€‚

Vite çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯å¯¹äºä¸åŒçš„ Vue ç‰ˆæœ¬ï¼Œéœ€è¦ç”¨åˆ°ä¸åŒçš„æ’ä»¶ã€‚

å®‰è£… Vite

```bash
$ yarn add -D
```

å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ Vue æ’ä»¶

> Vite ä¸º Vue æä¾›ç¬¬ä¸€ä¼˜å…ˆçº§æ”¯æŒï¼š
>
> - Vue 3 å•æ–‡ä»¶ç»„ä»¶æ”¯æŒï¼š[@vitejs/plugin-vue](https://github.com/vitejs/vite/tree/main/packages/plugin-vue)
> - Vue 3 JSX æ”¯æŒï¼š[@vitejs/plugin-vue-jsx](https://github.com/vitejs/vite/tree/main/packages/plugin-vue-jsx)
> - Vue 2 æ”¯æŒï¼š[underfin/vite-plugin-vue2](https://github.com/underfin/vite-plugin-vue2)

ç”±äºæˆ‘ä»¬ä½¿ç”¨ Vue2ï¼Œå› æ­¤å®‰è£… `vite-plugin-vue2`

```bash
$ yarn add -D vite-plugin-vue2
```

åœ¨æ ¹ç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶ `vite.config.js`

```json
import { defineConfig } from 'vite'
const { createVuePlugin } = require('vite-plugin-vue2')

// https://vitejs.dev/config/
export default defineConfig(() => {
  return {
    base: './',
    clearScreen: false,
    plugins: [createVuePlugin()],
    build: {
      target: 'es2015',
    },
  }
})
```

**å®Œç»“æ’’èŠ±ï¼ï¼ï¼**

å¦‚æœä½ çš„é¡¹ç›®æ²¡æœ‰å…¶ä»–ç‰¹æ®Šçš„éœ€æ±‚çš„è¯ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ åŸºæœ¬ä¸Šåº”è¯¥å¯ä»¥è·‘èµ·æ¥äº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬çš„é¡¹ç›®å°±æ²¡è¿™ä¹ˆå¹¸è¿äº†ï¼Œæ—…é€”æ‰åˆšåˆšå¼€å§‹ã€‚ã€‚ã€‚

## å¡«å‘ä¹‹æ—…

### å¯ç”¨ JSX

Vite é»˜è®¤æ˜¯ä¸å¯ç”¨ JSX çš„ï¼Œå¦‚æœè¦å¼€å¯ JSX æ”¯æŒè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œéœ€è¦ï¼š

1. å®ä¾‹åŒ– Vue2 æ’ä»¶çš„æ—¶å€™ä¼ å…¥`{jsx: true}` å¼€å¯ JSX æ”¯æŒã€‚

   ```js
   export default defineConfig(() => {
     return {
       plugins: [createVuePlugin({ jsx: true })], // å¼•å…¥Vue2æ’ä»¶å¹¶å¼€å¯JSXæ”¯æŒ
     };
   });
   ```

2. åœ¨ç”¨åˆ°çš„ç»„ä»¶ä¸ŠåŠ ä¸Š `jsx` æ ‡è¯†

   ```js
   <script lang="jsx">
       export default {
           render(){
               return <div>JSX Render</div>
           }
       }
   </script>
   ```

3. å¦‚æœæ˜¯ js æ–‡ä»¶ï¼Œç”¨åˆ°äº† `jsx` è¯­æ³•ï¼Œåˆ™éœ€è¦å°†åç¼€åæ”¹å®Œ `.jsx` ã€‚

### alias

åœ¨åŸé¡¹ç›®ä¸­æˆ‘ä»¬åœ¨ `vue.config.js` ä¸­ å®šä¹‰äº†ä½¿ç”¨äº† Webpack çš„ `resolve.alias` ç‰¹æ€§ï¼š

```js
{
	"configureWebpack":{
		resolve: {
      alias: {
        '@': resolve('src'),
        '@api': resolve('src/api'),
        '@components': resolve('src/components'),
        '@containers': resolve('src/containers'),
        '@services': resolve('src/services'),
        '@styles': resolve('src/styles'),
        '@utils': resolve('src/utils'),

        '@@containers': resolve(
          'node_modules/web-lib/packages/web-lib-containers/lib'
        ),
        '@@components': resolve(
          'node_modules/web-lib/packages/web-lib-components/lib'
        ),
        '@@services': resolve(
          'node_modules/web-lib/packages/web-lib-services/lib'
        ),
        '@@utils': resolve('node_modules/web-lib/packages/web-lib-utils/lib'),
        '@@styles': resolve('node_modules/web-lib/packages/web-lib-styles/lib'),
      },
    },
	}
}
```

æŸ¥çœ‹ Vite çš„é…ç½®æ–‡æ¡£ï¼Œå‘ç°å†…ç½®æ”¯æŒäº† aliasï¼Œè™½ç„¶æ˜¯é€šè¿‡ `@rollup/plugin-alias` æ¥å®ç°çš„ï¼Œä½†æ˜¯å¹¸è¿çš„æ˜¯é…ç½®æ–¹å¼åŸºæœ¬æ˜¯ä¸€è‡´çš„ã€‚

å› æ­¤åœ¨`vite.config.js` ä¸­è¿”å›çš„é…ç½®å¯¹è±¡ä¸­æ·»åŠ å¯¹åº”é…ç½® `resolve.alias` , ç›´æ¥å¤åˆ¶åŸæœ‰é…ç½®å¯¹è±¡å³å¯ã€‚

```js
resolve: {
      alias: {
        '@': resolve('src'),
        '@api': resolve('src/api'),
        '@components': resolve('src/components'),
        '@containers': resolve('src/containers'),
        '@services': resolve('src/services'),
        '@styles': resolve('src/styles'),
        '@utils': resolve('src/utils'),

        '@@containers': resolve(
          'node_modules/web-lib/packages/web-lib-containers/lib'
        ),
        '@@components': resolve(
          'node_modules/web-lib/packages/web-lib-components/lib'
        ),
        '@@services': resolve(
          'node_modules/web-lib/packages/web-lib-services/lib'
        ),
        '@@utils': resolve('node_modules/web-lib/packages/web-lib-utils/lib'),
        '@@styles': resolve('node_modules/web-lib/packages/web-lib-styles/lib'),
      },
}
```

### å®¢æˆ·ç«¯ä»£ç ä¸­ä¸èƒ½ä½¿ç”¨ node å†…éƒ¨æ¨¡å—

Vite ä¸­ä¸å¯¹æ¨¡å—å…¼å®¹åšå¤„ç†ï¼Œå› æ­¤ä¸€äº› Node çš„å†…ç½®æ¨¡å—åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å°†æ— æ³•æ‰¾åˆ°ã€‚å¦‚æœç¡®å®éœ€è¦ç”¨åˆ°ï¼Œåˆ™éœ€è¦æ›¿æ¢ä¸ºå¯¹åº”çš„æµè§ˆå™¨å…¼å®¹å®ç°ã€‚

å¦‚ `path` æ¨¡å—å¯ä»¥æ¢æˆå¯¹åº”çš„æµè§ˆå™¨å…¼å®¹å®ç° `path-browserify` ã€‚

åŸæœ‰ä»£ç ä½¿ç”¨ `path.join` æ¥æ‹¼æ¥è·¯å¾„ï¼š

```js
import path from "path";

export function genPath(...paths) {
  return path.join(...paths);
}
```

åœ¨ Vite ä¸­åˆ™éœ€è¦ä¿®æ”¹ä¸ºå¯¹åº”æµè§ˆå™¨å…¼å®¹å®ç° `path-browserify`

é¦–å…ˆå®‰è£… `path-browserify`

```bash
$ yarn add path-browserify
```

ç„¶åç›´æ¥æ›¿æ¢å¼•ç”¨å³å¯

```js
import path from "path-browserify";

export function genPath(...paths) {
  return path.join(...paths);
}
```

### å…¨å±€ CSS å˜é‡

åœ¨æˆ‘ä»¬åŸé¡¹ç›®ä¸­åœ¨`vue.config.js` ä¸­é…ç½®å¼•å…¥äº† [sass-resources-loader](https://github.com/shakacode/sass-resources-loader) æ¥å®ç°ã€‚

```js
chainWebpack(config) {
	// å¼•å…¥å…¨å±€çš„sassèµ„æº
    const oneOfsMap = config.module.rule('scss').oneOfs.store
    oneOfsMap.forEach(item => {
      item
        .use('sass-resources-loader')
        .loader('sass-resources-loader')
        .options({
          resources: [
            './node_modules/web-lib/packages/web-lib-styles/src/variables/index.scss',
            './src/styles/variables.scss',
          ],
        })
        .end()
    })
}
```

åœ¨ Vite ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ ` css.preprocessorOptions` è¿›è¡Œé…ç½®ã€‚

```js
css: {
      preprocessorOptions: {
        scss: {
          additionalData: `@import './node_modules/web-lib/packages/web-lib-styles/src/variables/index.scss';`,
        },
      },
}
```

å¦‚æœä½ ç»†å¿ƒçš„è¯å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘ä»¬çš„åŸä»£ç ä¸­å¼•å…¥äº†ä¸¤ä¸ª CSS æ–‡ä»¶ã€‚è€Œè¿ç§»åçš„æˆ‘ä»¬åªå¼•å…¥äº†ä¸€ä¸ª CSS æ–‡ä»¶ã€‚åŸå› æ˜¯åœ¨ `./src/styles/variables.scss` ä¸­æˆ‘ä»¬ä½¿ç”¨äº†ä¸‹é¢çš„è¯­æ³•å¯¼å‡ºäº† js å˜é‡

```scss
// å¯¼å‡ºï¼Œä¾›jsæ¨¡å—è°ƒç”¨
:export {
  bg: $bg;
  text_color: $text_color;
  header_height: $header_height;
  sidebar_width: $sidebar_width;
  header_bg: $header_bg;
  logo_bg: $logo_bg;
  menu_bg: $menu_bg;
  menu_text_color: $menu_text_color;
  menu_active_text_color: $menu_active_text_color;
  menu_hover: $menu_hover;
}
```

åœ¨ Vite ä¸­ä¼šå‡ºç°ï¼Œå¦‚æœé…ç½®äº† `additionalData`ï¼Œå°†ä¼šæŠ¥é”™ï¼š

```bash
Error: This file is already being loaded.
    â•·
  2 â”‚           @import './src/styles/variables.scss';
    â”‚                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    â•µ
    src/styles/variables.scss 2:19  root stylesheet
```

å¯å‚è€ƒä»¥ä¸‹ ISSUE:

- https://github.com/vitejs/vite/issues/3283
- https://github.com/nuxt/vite/issues/117

ç›®å‰æˆ‘ä»¬çš„è§£å†³æ–¹å¼å°±æ˜¯ä¸å¼•å…¥ï¼Œç„¶ååœ¨ç”¨åˆ°çš„åœ°æ–¹æ‰‹åŠ¨è¿›è¡Œå¼•å…¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰ç‰¹åˆ«å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

### åŠ¨æ€å¯¼å…¥ png ç­‰å›¾ç‰‡èµ„æº

åœ¨ Vue CLI é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é€šè¿‡è¿è¡Œæ—¶å˜é‡æ¥åŠ¨æ€ç¡®å®šä¸€äº›é™æ€èµ„æºæ¥è¿›è¡Œå¯¼å…¥

```js
const iconSrc = require(`./images/${iconName}.png`);
```

ä¸Šé¢çš„ä»£ç ä½¿ç”¨ webpack çš„ url-loader æˆ– url-loaderï¼Œå°†è¢«è‡ªåŠ¨å¤„ç†

Vite å¤„ç†å›¾ç‰‡èµ„æºçš„åŠ¨æ€å¼•å…¥ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. ä½¿ç”¨ `import.meta.globEager` glob å¼•å…¥

   > è¿™ç§æ–¹å¼å°†ä¼šå…¨é‡çš„å¼•å…¥åŒ¹é…çš„å›¾ç‰‡

   ```js
   const images = import.meta.globEager("./images/*.png"); // å°†ä¼šç›´æ¥å¯¼å…¥æ‰€æœ‰åŒ¹é…çš„å›¾ç‰‡
   const iconSrc = iamges[`./images/${iconName}.png`].default;

   if (iamges[`./images/${iconName}.png`]) {
     // TODO
   } else {
     // TODO
   }
   ```

2. ä½¿ç”¨ `new URL(url, import.meta.url)` å¼•å…¥

   > è¿™ç§æ–¹å¼å¦‚æœå›¾ç‰‡ä¸å­˜åœ¨åœ¨ä»£ç å±‚é¢æ— æ³•åˆ¤æ–­

   ```js
   const iconSrc = new URL(`./images/${iconName}.png`, import.meta.url); // å°†è¿”å›ä¸€ä¸ªURLå®ä¾‹
   ```

### svg é›ªç¢§å›¾

åœ¨åŸé¡¹ç›®ä¸­æˆ‘ä»¬ä½¿ç”¨äº† webpack çš„ [svg-sprite-loader](https://github.com/JetBrains/svg-sprite-loader) æ’ä»¶æ¥å®ç° svg é›ªç¢§å›¾ã€‚

```js
chainWebpack(config) {
  // set svg-sprite-loader
    config.module
      .rule('svg')
      .exclude.add(resolve('src/icons'))
      .end()
    config.module
      .rule('icons')
      .test(/\.svg$/)
      .include.add(resolve('src/icons'))
      .end()
      .use('svg-sprite-loader')
      .loader('svg-sprite-loader')
      .options({
        symbolId: 'icon-[name]',
      })
      .end()
}
```

æ„Ÿè°¢ç¤¾åŒºï¼Œåœ¨ Vite ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’ä»¶**[ vite-plugin-svg-icons ](https://github.com/anncwb/vite-plugin-svg-icons)** æ¥è¿›è¡Œæ›¿æ¢ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥æŸ¥çœ‹ç›¸åº”æ–‡æ¡£ã€‚

> æ³¨æ„: svg-sprite-loader éœ€è¦æ‰‹åŠ¨å¼•å…¥ svg æ–‡ä»¶ï¼Œè€Œ vite-plugin-svg-icons ä¼šè‡ªåŠ¨å¼•å…¥ã€‚

åœ¨ Vite é…ç½®çš„ `plugins` é€‰é¡¹ä¸­å¼•å…¥æ’ä»¶

```js
import viteSvgIcons from 'vite-plugin-svg-icons'

export default defineConfig(({ mode }) => {
 return {
   viteSvgIcons({
        iconDirs: [resolve('src/icons/svg')],
        symbolId: 'icon-[name]',
    }),
 	}
}
```

åœ¨ `main.js` ä¸­å¼•å…¥

```js
import "virtual:svg-icons-register";
```

### Glob å¯¼å…¥

åœ¨è€é¡¹ç›®ä¸­æˆ‘ä»¬å¦‚æœä½¿ç”¨äº† webpack çš„ `require.context` è¯­æ³•ï¼Œåœ¨ Vite ä¸­ä¼šæŠ¥é”™ã€‚å¯¹åº”çš„ï¼ŒVite æä¾›äº†`import.meta.glob` å’Œ `import.meta.globEager` æ¥ä»£æ›¿

ä¾‹å¦‚åŸæœ¬çš„`src/store/index.js` ä¸­åŠ¨æ€å¼•å…¥ modules

```js
// è·å–æ¨¡å—æ–‡ä»¶
const getModuleFiles = () => require.context("./modules", true, /\.js$/);
// è·å–æ¨¡å—å¯¹è±¡è¡¨
const getModules = () => {
  const storeFiles = getModuleFiles();

  const modules = storeFiles.keys().reduce((modules, modulePath) => {
    // set './app.js' => 'app'
    const moduleName = modulePath.replace(/^\.\/(.*)\.\w+$/, "$1");
    const value = storeFiles(modulePath);
    modules[moduleName] = value.default;
    return modules;
  }, {});
  return modules;
};

const modules = getModules();
```

åœ¨ Vite ä¸­æ”¹ä¸º

```js
const files = import.meta.globEager("./modules/*.js");

const modules = Object.keys(files).reduce((pre, path) => {
  pre[path.replace(/(\.\/modules\/|\.js)/g, "")] = files[path].default;
  return pre;
}, {});
```

### çƒ­æ›´æ–°

åœ¨åŸæœ¬çš„`src/store/index.js` ä¸­æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯äº† store çš„çƒ­æ›´æ–°

```js
// å¯ç”¨æ¨¡å—çƒ­æ›´æ–°
if (module.hot) {
  const modulePaths = getModuleFiles().keys();
  module.hot.accept(["./getters", ...[modulePaths]], () => {
    // è·å–æ›´æ–°åçš„æ¨¡å—
    const getters = require("./getters").default;
    const modules = getModules();
    // åŠ è½½æ–°æ¨¡å—
    store.hotUpdate({
      getters,
      modules,
    });
  });
}
```

åœ¨ Vite ä¸­ç›´æ¥ç§»é™¤å³å¯ï¼Œä¸éœ€è¦é¢å¤–é…ç½®ã€‚

### åœ¨ Vite é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡

å¦‚æœæƒ³åœ¨ Vite é…ç½®ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ `import.meta.env` æ¥è·å–çš„ï¼Œå› ä¸º Vite æ˜¯å…ˆè§£æé…ç½®æ–‡ä»¶å†è§£æç¯å¢ƒå˜é‡çš„ã€‚å› æ­¤åªèƒ½é€šè¿‡ [dotenv](https://github.com/motdotla/dotenv) æ¥æ‰‹åŠ¨è§£æè®¿é—®ã€‚

```js
export default defineConfig(({ mode }) => {
  // è®¿é—®é€šç”¨ç¯å¢ƒå˜é‡
  const { PORT } = require("dotenv").config({ path: `./.env` }).parsed || {};

  // è®¿é—®åŸºäºè¿è¡Œç¯å¢ƒçš„ç¯å¢ƒå˜é‡
  const {
    VITE_APP_URI_BUSINESS_SERVICE_BASE,
    VITE_APP_URI_FILE_SERVICE_BASE,
    VITE_APP_USER_SOCTET_BASE,
  } = require("dotenv").config({ path: `./.env.${mode}` }).parsed || {};
  return {
    server: {
      port: PORT,
    },
  };
});
```

## å°ç”œå“ï¼Œæ¥ç‚¹å·¥ç¨‹åŒ–ä¼˜åŒ–

### husky+lint-staged å®ç°æäº¤ lint

husky å¯ä»¥è®©æˆ‘ä»¬å®šä¹‰å„ç§ git-hooksï¼Œä»¥å®ç°åœ¨ git ç”Ÿå‘½å‘¨æœŸä¸­æ³¨å…¥å„ç§é’©å­æ¥å®šä¹‰æˆ‘ä»¬çš„å·¥ä½œæµï¼Œæ¯”å¦‚åšä»£ç æ ¡éªŒæˆ–è€…é‚®ä»¶é€šçŸ¥ç­‰ã€‚lint-staged åˆ™è®©æˆ‘ä»¬å¯ä»¥åªå¯¹å¾…æäº¤çš„ä»£ç è¿›è¡Œå¤„ç†ã€‚ç»“åˆä¸¤è€…ä¾¿èƒ½å®ç°åœ¨æœŸæœ›çš„ git ç”Ÿå‘½å‘¨æœŸä¸­è§¦å‘å¯¹æ–°æäº¤ä»£ç è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚æœ€å¸¸è§çš„ä¾¿æ˜¯åœ¨ git çš„ commit ä¹‹å‰ï¼ˆ`pre-commit`ï¼‰ï¼Œå¯¹ä»£ç è¿›è¡Œæ ¡éªŒå’Œæ ¼å¼åŒ–ã€‚

#### å®‰è£…åŠä½¿ç”¨

1. å®‰è£… `husky`

   ```bash
   $ yarn add -D husky
   ```

2. å¼€å¯ Git hooks

   ```bash
   yarn husky install
   ```

3. æ·»åŠ å®‰è£…é¡¹ç›®ä¾èµ–åè‡ªåŠ¨å¼€å¯ Git hooks

   `package.json`

   ```bash
   {
     "scripts": {
       "prepare": "husky install"
     }
   }
   ```

4. å®‰è£… lint-staged

   ```bash
   $ yarn add -D lint-staged
   ```

5. é…ç½® lint-staged

   `package.json`

   ```json
   {
     "lint-staged": {
       "**/*.{vue,js}": ["prettier --write", "eslint --fix", "git add"],
       "**/*.{html,vue,css,scss}": [
         "prettier --write",
         "stylelint --allow-empty-input --fix",
         "git add"
       ],
       "**/*.{md,json}": ["prettier --write", "git add"]
     }
   }
   ```

6. é…ç½® hook åœ¨æäº¤æ—¶è§¦å‘ lint-staged

   ```bash
   $ npx husky add .husky/pre-commit "npx lint-staged"
   ```

7. å°† hook æ·»åŠ åˆ° git ä¸­

   ```bash
   $ git add .husky/pre-commit
   ```

#### git æ”¯æŒçš„é’©å­åŠç®€å•ä»‹ç»

| é’©å­ç±»å‹           | é’©å­åç§°           | è§¦å‘æ—¶æœº                                                                                           | é’©å­å‚æ•°                  | å¯ä¸­æ­¢ |
| ]]></summary>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[TypeScript Learning]]></title>
        <id>https://jiangwenyang.com/posts/TypeScriptç®€æ˜æŒ‡åŒ—</id>
        <link href="https://jiangwenyang.com/posts/TypeScriptç®€æ˜æŒ‡åŒ—"/>
        <updated>2019-10-23T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[CSSä¸­çš„ç©ºç™½ç¬¦å’Œæ¢è¡Œå¤„ç†]]></title>
        <id>https://jiangwenyang.com/posts/CSSä¸­çš„ç©ºç™½ç¬¦å’Œæ¢è¡Œå¤„ç†</id>
        <link href="https://jiangwenyang.com/posts/CSSä¸­çš„ç©ºç™½ç¬¦å’Œæ¢è¡Œå¤„ç†"/>
        <updated>2018-09-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[
## CSS ä¸­çš„ç©ºç™½ç¬¦å’Œæ¢è¡Œå¤„ç†

CSS ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªå±æ€§ç”¨æ¥å¤„ç†ç©ºç™½ç¬¦å’Œæ¢è¡Œï¼š`white-space` `word-break` `word-wrap` ï¼Œé•¿å¾—æœ‰ç‚¹ç›¸ä¼¼ï¼Œåœ¨ä¸­æ–‡ç¯å¢ƒä¸‹ç”¨åˆ°çš„æœºä¼šä¸å¤ªå¤šï¼Œä½†æ˜¯æ¯æ¬¡ç”¨åˆ°éƒ½å‚»å‚»åˆ†ä¸æ¸…æ¥šï¼Œä¸‹é¢æ•´ç†ä¸‹è¿™å‡ ä¸ªå±æ€§çš„åŒºåˆ«ã€‚

### white-space

`white-space` çœ‹åå­—å°±çŸ¥é“ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†ç©ºç™½ç¬¦çš„ï¼Œä½†æ˜¯ä¹Ÿæ¶‰åŠåˆ°æ¢è¡Œçš„é—®é¢˜ã€‚

`white-space` çš„æœ‰ä¸‹åˆ—çš„å€¼ï¼Œå¯¹åº”å…¶ä¸­çš„ç©ºç™½ç¬¦å’Œæ¢è¡Œç¬¦å¤„ç†æƒ…å†µï¼š

| å±æ€§              | ç©ºç™½ç¬¦                 | æ¢è¡Œç¬¦             | è¶…å‡ºæ˜¯å¦è‡ªåŠ¨æ¢è¡Œ |
| ]]></summary>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•]]></title>
        <id>https://jiangwenyang.com/posts/å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•</id>
        <link href="https://jiangwenyang.com/posts/å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•"/>
        <updated>2018-06-19T10:20:26.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[Stroybook]]></title>
        <id>https://jiangwenyang.com/posts/Stroybook</id>
        <link href="https://jiangwenyang.com/posts/Stroybook"/>
        <updated>2018-03-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[
# Stroybook

### ä»€ä¹ˆæ˜¯ Storybook?

Stroybook æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„ UI å¼€å‘ç¯å¢ƒï¼Œé€šè¿‡ Stroybook ä½ èƒ½å¿«é€Ÿçš„æ¸²æŸ“å±•ç¤º UI ç»„ä»¶ï¼Œå°† UI ç»„ä»¶ä¸é¡¹ç›®éš”ç¦»ï¼Œå¹¶ä¸”é€šè¿‡æä¾›çš„ä¸°å¯Œçš„æ’ä»¶æ¥æå‡å¼€å‘ä½“éªŒã€‚

### ä½¿ç”¨ Strorybook

Stroybook ä¸ä»…ä»…å¯ä»¥åº”ç”¨äº React é¡¹ç›®ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ Vue å’Œ Angularï¼Œç”±äºç›®å‰é¡¹ç›®ä½¿ç”¨ Reactï¼Œå¹¶ä¸” Storybook å¯¹ React çš„æ”¯æŒåº¦æ›´å¥½ï¼Œå› æ­¤åœ¨æ­¤åªä»‹ç» Stroybook for Reactã€‚

#### 1. å®‰è£…

å®‰è£…é…ç½® Storybook å®˜æ–¹æä¾›äº†ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨æä¾›çš„ cli å·¥å…·è¿›è¡Œå¿«é€Ÿç”Ÿæˆï¼Œä¸€ç§æ˜¯æ‰‹åŠ¨å®‰è£…é…ç½®ã€‚æ¨èè‡ªå·±æ‰‹åŠ¨é…ç½®å®‰è£…ä»¥ç†Ÿæ‚‰ Storybookã€‚

##### 1.1 å¿«é€Ÿç”Ÿæˆ

Stroybook å®˜æ–¹æä¾›äº†å¿«é€Ÿç”Ÿæˆ Stroybook é¡¹ç›®éª¨æ¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥åœ¨å·²æœ‰é¡¹ç›®ä¸‹ä½¿ç”¨ã€‚
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š

```bash
$ npm i -g @storybook/cli
$ getstorybook
```

ä¸Šé¢çš„å‘½ä»¤å°†ä¼šä¸ºä½ å¿«é€Ÿç”Ÿæˆå¯¹åº”ä½ çš„é¡¹ç›®çš„ storybookã€‚å°†ä¼šå®‰è£…å¯¹åº”çš„ä¾èµ–ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`.storybook`é…ç½®ç›®å½•å¹¶ç”Ÿæˆå¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œåˆ›å»º`stories`ç›®å½•å¹¶åˆ›å»ºé»˜è®¤çš„`stories`çš„ demo

##### 1.2 è‡ªå®šä¹‰é…ç½®

å¦‚æœä¸æƒ³å…¨å±€å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸”å¸Œæœ›è‡ªå®šä¹‰ Stroybookï¼Œæ¨èè‡ªå®šä¹‰å®‰è£…é…ç½® Stroybookã€‚

1. å®‰è£…`@storybook/react`

```bash
$ yarn add -D @storybook/react
```

2. å®‰è£… reactï¼Œreact-domï¼Œbabel-core

```bash
yarn add react react-dom
yarn add -D babel-core
```

> Storybook å®˜æ–¹æ²¡æœ‰ç»™å‡ºå…¼å®¹æ€§åˆ—è¡¨ï¼Œä½†å®æµ‹æ— æ³•ä½¿ç”¨ React 0.14

3. æ·»åŠ  NPM script
   ç¼–è¾‘`package.json`ï¼Œæ·»åŠ å¯åŠ¨ Storybook çš„ script å­—æ®µ

```json
{
  "scripts": {
    "storybook": "start-storybook -p 9001 -c .storybook"
  }
}
```

> `-c` å‚æ•°åè·Ÿé…ç½®æ–‡ä»¶æ‰€å¤„ç›®å½•ï¼Œä¸ä½¿ç”¨`-c`æ—¶å°†é»˜è®¤ä½¿ç”¨`.storybook`ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶`config.js`

#### 2. é…ç½®

> å¦‚æœä½¿ç”¨å¿«é€Ÿç”Ÿæˆåˆ™ä¸‹é¢è¿™äº›é…ç½®æ–‡ä»¶å·²ç»å¸®ä½ ç”Ÿæˆå¥½äº†æ— éœ€å†è‡ªå·±é…ç½®ã€‚

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`.storybook`æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º`config.js`æ–‡ä»¶ã€‚
æœ€ç®€å•çš„é…ç½®ï¼š

```javascript
import { configure } from '@storybook/react';

function loadStories() {
  require('../stories/index.js');
  // You can require as many stories as you need.
}

configure(loadStories, module);
```

ä¸Šé¢çš„é…ç½®æ–‡ä»¶å°†ä¼šä½¿ç”¨`stories/index.js`ä¸­çš„ storiesï¼Œå¦‚æœä½ æœ‰å¤šä¸ª storiesï¼Œæ¯æ¬¡å†™ stories çš„æ—¶å€™éœ€è¦å¯¹åº”çš„è¿›è¡Œ requireï¼Œæ¯”è¾ƒç¹çã€‚å¦‚æœä½¿ç”¨ Webpackï¼Œå¯ä»¥ä½¿ç”¨ Webpack çš„[require.context](https://webpack.js.org/guides/dependency-management/)è¯­æ³•ï¼š

```javascript
import { configure } from '@storybook/react';

function loadStories() {
  const storiesContext = require.context("../src", true, /\.stories\.tsx$/);
  storiesContext.keys().forEach(storiesContext);
  // å°†ä¼šåŠ è½½srcæ‰€æœ‰å­ç›®å½•ä¸‹çš„ä»¥.stories.tsxç»“å°¾çš„æ¨¡å—
  // You can require as many stories as you need.
}

configure(loadStories, module);
```

#### 3. å†™ stories

åœ¨ç»„ä»¶ç›®å½•ä¸‹æ–°å»ºå¯¹åº” stories æ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨ Button ç»„ä»¶ç›®å½•ä¸‹æ–°å»º`stories/Button.stories.tsx`

```javascript
import React from 'react';
import { storiesOf } from '@storybook/react';
import { action } from '@storybook/addon-actions';
import Button from '../ui.desktop.tsx';

storiesOf('Button', module)
  .add('with text', () => (
    <Button onClick={action('clicked')}>Hello Button</Button>
  ))
  .add('with some emoji', () => (
    <Button onClick={action('clicked')}>ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯</Button>
  ));
```

ç„¶åæ‰§è¡Œ`npm run storybook`æˆ–è€…`yarn storybook`æ‰“å¼€[localhost:9001](localhost:9001)å°†çœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ç•Œé¢
![](http://ow67vzejn.bkt.clouddn.com/18-1-31/1015387.jpg)

#### 4. ä½¿ç”¨ addon

Storybook é€šè¿‡æ’ä»¶çš„æ–¹å¼ä½¿ç”¨é¢å¤–çš„åŠŸèƒ½ï¼Œä¸»è¦æœ‰ä¸¤ç§æ’ä»¶ï¼š
**Decorators ç±»è£…é¥°å™¨æ’ä»¶**
Decorators æ’ä»¶åˆåˆ†ä¸ºä¸¤ç§:

1. Wrapper Components
   å°±æ˜¯æ™®é€šçš„ react å®¹å™¨ç»„ä»¶ï¼Œç®€å•çš„å°†ä½ éœ€è¦ story çš„ç»„ä»¶åŒ…è£¹åœ¨å…¶ä¸­ã€‚

```javascript
const styles = {
  textAlign: 'center',
};
const Center = ({ children }) => (
  <div style={styles}>
    { children }
  </div>
);
```

2. Storybook Decorators
   æ‰©å±•ä¸€ä¸ªå‡½æ•°ä½œä¸º storybook decoratorã€‚

```javascript
import { storiesOf } from '@storybook/react';
import { action } from '@storybook/addon-actions';

import Button from './button';

const styles = {
  textAlign: 'center',
};
const CenterDecorator = (storyFn) => (
  <div style={styles}>
    { storyFn() }
  </div>
);

storiesOf('Button', module)
  .addDecorator(CenterDecorator)
  .add('with text', () => (
    <Button onClick={action('clicked')}>Hello Button</Button>
  ))
  .add('with some emojies', () => (
    <Button onClick={action('clicked')}>ğŸ˜€ ğŸ˜ ğŸ‘ ğŸ’¯</Button>
  ));

```

> ä½¿ç”¨`.addDecorator(Decorator)`è¯­æ³•ä»£ç æ›´åŠ ç®€æ´,å¦‚æœè¦ä½¿ç”¨å…¨å±€çš„ Decorator å¯ä»¥åœ¨`config.js`ä¸­é…ç½®å…¨å±€çš„`Decorator`ï¼Œå°†ä¼šåº”ç”¨åˆ°æ‰€æœ‰çš„ stories

ä¾‹å¦‚éœ€è¦å±…ä¸­æ˜¾ç¤ºæ‰€æœ‰çš„ storiesï¼š

```javascript
import * as React from 'react'
import { configure,addDecorator,setAddon } from '@storybook/react';
addDecorator(stories=>(
		<div style={{textAlign: 'center'}}>
		    {stories()}
		</div>
	)
)
```

**Native Addons åŸç”Ÿæ’ä»¶**
åŸç”Ÿæ’ä»¶èƒ½åœ¨åŒ…è£¹ stories ä¹‹å‰æä¾›åŸºäº Storybook å¹³å°çš„é¢å¤–ç‰¹æ€§ï¼Œä¾‹å¦‚ storybook-actions æ’ä»¶ã€‚

ä½¿ç”¨è¿™ä¸¤ç§æ’ä»¶å‰ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å…ˆåœ¨`.storybook`ç›®å½•ä¸‹æ–°å»º`addons.js`æ¥æ³¨å†Œå¯¹åº”çš„æ’ä»¶

```typescript
import "@storybook/addon-actions/register";
import "@storybook/addon-links/register";
import "@storybook/addon-notes/register";
```

æ’ä»¶çš„å…·ä½“ä½¿ç”¨é…ç½®éœ€è¦æŸ¥çœ‹æ’ä»¶è‡ªå·±çš„æ–‡æ¡£ã€‚

#### 5. è‡ªå®šä¹‰ Webpack é…ç½®

å½“ä½¿ç”¨ storybook æ—¶ï¼ŒStorybook å°†ä¼šä½¿ç”¨è‡ªå·±é»˜è®¤çš„ webpack é…ç½®,ä½¿ç”¨çš„æ˜¯ create-react-app çš„ webpack é…ç½®ï¼Œä¸€èˆ¬è€Œè¨€é€‚ç”¨äºç»å¤§å¤šæ•°é¡¹ç›®ã€‚å¦‚æœæƒ³è‡ªå®šä¹‰ webpack æœ‰ä¸‹é¢å‡ ç§æ–¹å¼ï¼š
**Extend Mode (æ‰©å±•æ¨¡å¼)**
åœ¨`.storybook`ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶`webpack.config.js`ï¼Œå¯¼å‡ºä¸€ä¸ª**object**

```javascript
const path = require('path');

module.exports = {
  module: {
    rules: [
      {
        test: /\.scss$/,
        loaders: ["style-loader", "css-loader", "sass-loader"],
        include: path.resolve(__dirname, '../')
      }
    ]
  }
}
```

æ‰©å±•æ¨¡å¼ä¸‹å¯ä»¥æ›´æ”¹é™¤ï¼š

- entry
- output
- js loader with babel

è¿™å‡ é¡¹å¤–æ‰€æœ‰çš„ webpack é…ç½®é¡¹ï¼ŒStorybook å°†ä¼šå°†ä½ çš„è‡ªå®šä¹‰é…ç½®é¡¹ä½œä¸ºé»˜è®¤é…ç½®çš„æ‰©å±•æ¥å¯åŠ¨ webpackã€‚

**Full Control Mode (å®Œå…¨æ§åˆ¶æ¨¡å¼)**
é€šè¿‡å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•° storybookBaseConfig å’Œ configTypeï¼Œä¸€ä¸ªæ˜¯ Storybook çš„åŸºç¡€é…ç½®å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å½“å‰çš„ç¯å¢ƒï¼ˆ'DEVELOPMENT' or 'PRODUCTION'ï¼‰ï¼Œç„¶åé€šè¿‡ä¿®æ”¹ storybookBaseConfig åè¿”å›è‡ªå®šä¹‰çš„é…ç½®å¯¹è±¡è¾¾åˆ°å®Œå…¨æ§åˆ¶çš„ç›®çš„ã€‚
å®˜æ–¹çš„ DMEOï¼š

```javascript
const path = require('path');

// Export a function. Accept the base config as the only param.
module.exports = (storybookBaseConfig, configType) => {
  // configType has a value of 'DEVELOPMENT' or 'PRODUCTION'
  // You can change the configuration based on that.
  // 'PRODUCTION' is used when building the static version of storybook.

  // Make whatever fine-grained changes you need
  storybookBaseConfig.module.rules.push({
    test: /\.scss$/,
    loaders: ["style-loader", "css-loader", "sass-loader"],
    include: path.resolve(__dirname, '../')
  });

  // Return the altered config
  return storybookBaseConfig;
};
```

å°½é‡ä¸è¦å»æ›´æ”¹ä¸‹é¢è¿™å‡ é¡¹ï¼š

- entry
- output
- first loader in the module.loaders (Babel loader for JS)
- all existing plugins

**Full control mode + default ï¼ˆå®Œå…¨æ§åˆ¶+é»˜è®¤é…ç½® æ¨¡å¼ï¼‰**
å’Œå®Œå…¨é…ç½®æ¨¡å¼å‡ ä¹ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å¯¼å‡ºçš„å‡½æ•°å¤šäº†ä¸€ä¸ªå‚æ•° defaultConfigï¼Œå½“å¯¼å‡ºçš„å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°æ—¶å°†ä¼šä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚

```javascript
const path = require('path');

module.exports = (baseConfig, env, defaultConfig) => {
  // Extend defaultConfig as you need.

  // For example, add typescript loader:
  defaultConfig.module.rules.push({
    test: /\.(ts|tsx)$/,
    include: path.resolve(__dirname, '../src'),
    loader: require.resolve('ts-loader')
  });
  defaultConfig.resolve.extensions.push('.ts', '.tsx');

  return defaultConfig;
};
```

> å»ºè®®ä½¿ç”¨æ‰©å±•æ¨¡å¼ï¼Œé…ç½®æ¯”è¾ƒç®€å•ã€‚å¦‚æœéœ€è¦æ ¹æ®ä¸åŒçš„ç¯å¢ƒè¿›è¡Œä¸åŒçš„ç¼–è¯‘é…ç½®ï¼Œä½¿ç”¨å…¨æ§åˆ¶æ¨¡å¼é…ç½®ã€‚
> Storybook çš„åŸºç¡€é…ç½®ä¸­åªåŒ…å«äº† babel-loader å’Œ md è§£æç”¨çš„ loaderï¼Œé»˜è®¤é…ç½®ä¸­é…ç½®äº†ä¾‹å¦‚ cssã€jsonã€å­—ä½“æ–‡ä»¶ã€åª’ä½“æ–‡ä»¶ç›¸å…³çš„ loaderï¼Œå¯ä»¥åœ¨ node_modules\@storybook\react\src\server\config ä¸‹çœ‹åˆ°å¯¹åº”çš„ webpack é…ç½®æ–‡ä»¶ã€‚

#### 6. æ³¨å…¥ script æˆ– css

å¦‚æœä½ çš„ UI åº“ä¾èµ–å…¨å±€çš„ script æˆ–è€… cssï¼Œå¯ä»¥é€šè¿‡ Storybook æä¾›çš„æ³¨å…¥çš„æ–¹å¼ã€‚

1. ç»„ä»¶é¢„è§ˆ iframe æ³¨å…¥
   åœ¨`./stroybook`ç›®å½•ä¸‹æ–°å»º`preview-head.html`,é‡Œé¢çš„ srcipt æˆ– css æ ‡ç­¾å°†æ³¨å…¥åˆ°é¢„è§ˆåŒºåŸŸçš„ iframe ä¸­ï¼Œåœ¨ stries åŠ è½½å‰è¢«æ³¨å…¥ã€‚
   ä¾‹å¦‚å¸Œæœ›æ¯ä¸ª UI ç»„ä»¶ä½¿ç”¨ reset.css
   åœ¨`preview-head.html`ä¸­æ·»åŠ 

```javascript
<style>
*{
	margin: 0;
	padding: 0;
}
</style>
```

2. Stroybook å¹³å°æ³¨å…¥
   åœ¨`./stroybook`ç›®å½•ä¸‹æ–°å»º`manager-head.html`,é‡Œé¢çš„ script æˆ– css æ ‡ç­¾å°†æ³¨å…¥åˆ° Stroybook å¹³å°ä¸‹ï¼Œå°†åœ¨ Stroybook React UI åŠ è½½å‰è¢«æ³¨å…¥ã€‚

### é…ç½®å‚è€ƒ

```javascript
import * as React from 'react'
import { configure,addDecorator,setAddon } from '@storybook/react';

/* å¯¼å…¥storybookæ’ä»¶ */
import { setOptions } from '@storybook/addon-options';
import JSXAddon from 'storybook-addon-jsx';
import { withKnobs } from '@storybook/addon-knobs/react';
import { withDocs } from 'storybook-readme';

/* é€šç”¨storybookåº•éƒ¨md */
import * as Doc_Footer from './Doc_Footer.md';

/* è®¾ç½®Storybook UI */
setOptions({
  name: 'AnyShare',
  url: 'https://anyshare.eisoo.com',
  goFullScreen: false,
  showLeftPanel: true,
  showDownPanel: true,
  showSearchBox: false,
  downPanelInRight: true,
});

/* è®¾ç½®ä½¿ç”¨JSXAddonï¼Œåœ¨ä¾§è¾¹æ æ˜¾ç¤ºæ¸²æŸ“åŒºåŸŸç»„ä»¶å¯¹åº”çš„JSX */
setAddon(JSXAddon);

withDocs.addFooterDocs(Doc_Footer); // å½“ä½¿ç”¨withDocsæ—¶ï¼Œä½¿ç”¨é€šç”¨åº•éƒ¨md

/* å…¨å±€storyè£…é¥°å™¨ */
addDecorator(withKnobs) // ä½¿ç”¨addon-knobsè£…é¥°å™¨ï¼Œå…è®¸è‡ªå®šä¹‰ç»„ä»¶å‚æ•°ï¼Œå…·ä½“å‚æ•°éœ€è¦åœ¨storyä¸­å®šä¹‰


/* åŠ è½½story */
function loadStories() {
  const storiesContext = require.context("../src", true, /\.stories\.tsx$/);
  storiesContext.keys().forEach(storiesContext);
}
configure(loadStories, module);
```

ShareWebUI/.sotrybook/addon.js ]]></summary>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[Git-hook]]></title>
        <id>https://jiangwenyang.com/posts/git-hook</id>
        <link href="https://jiangwenyang.com/posts/git-hook"/>
        <updated>2018-03-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[
## Git-hook

Git-hookï¼ˆgit é’©å­ï¼‰æ˜¯ Git æä¾›çš„å½“ç‰¹å®šåŠ¨ä½œå¦‚æäº¤ã€æ¨é€ç­‰ Git è¡Œä¸ºå‘ç”Ÿæ—¶æ‰§è¡Œçš„è‡ªå®šä¹‰è„šæœ¬ã€‚ä¸»è¦åˆ†ä¸ºå®¢æˆ·ç«¯è„šæœ¬å’ŒæœåŠ¡å™¨ç«¯è„šæœ¬ã€‚

### Git-hook çš„å®‰è£…

å…¶å®å½“åˆå§‹åŒ–ä¸€ä¸ª Git é¡¹ç›®çš„æ—¶å€™ï¼Œhooks å°±å·²ç»è¢«å®‰è£…åˆ°é¡¹ç›®ä¸­ï¼Œåªæ˜¯é»˜è®¤æœªå¯ç”¨ã€‚å½“æ‰§è¡Œ`git init`çš„æ—¶å€™ï¼ŒGit ä¼šåˆå§‹åŒ–ç¤ºä¾‹è„šæœ¬åˆ°`.git/hooks`ç›®å½•ä¸­ã€‚

å¦‚æœæƒ³å¯ç”¨è¿™äº› hooks éå¸¸ç®€å•ï¼Œåªéœ€è¦å»æ‰`.sample`åç¼€å³å¯å¯ç”¨ã€‚ç¤ºä¾‹ä»£ç æ˜¯ä½¿ç”¨ shell ç¼–å†™çš„,ä½†æ˜¯ git å¹¶æ²¡æ²¡æœ‰æ˜¾ç¤ºç¼–å†™ hooks ä½¿ç”¨çš„è¯­è¨€,ä»»ä½•å¯æ‰§è¡Œè„šæœ¬éƒ½å¯ä»¥ä½¿ç”¨ã€‚

> `.git`ç›®å½•æ— æ³•åŠ å…¥åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œå› ä¸ºæ¯æ¬¡ clone ä¸€ä¸ªæ–°çš„ä»“åº“çš„æ—¶å€™éƒ½ä¼šæ–°ç”Ÿæˆ`.git`ç›®å½•ã€‚
>
> ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œå› æ­¤åªèƒ½å°† hooks å­˜å‚¨åˆ°å…¶ä»–ç›®å½•ï¼Œé€šè¿‡è½¯é“¾æ¥æˆ–è€…æ‰‹åŠ¨æ‹·è´çš„æ–¹å¼æ‹·è´åˆ°`.git/hooks`ç›®å½•ä¸‹ï¼Œä½†æ˜¯è¿™æ ·çš„é—®é¢˜æ˜¯å½“æ›´æ–°æˆ–æ–°å¢ hooks è„šæœ¬çš„æ—¶å€™éœ€è¦é‡æ–°å»ºç«‹ä¸`.git/hooks`çš„å…³ç³»ã€‚

### å®¢æˆ·ç«¯é’©å­

å®¢æˆ·ç«¯é’©å­ä¸»è¦æœ‰æäº¤å·¥ä½œæµé’©å­ã€ç”µå­é‚®ä»¶å·¥ä½œæµé’©å­å’Œå…¶å®ƒé’©å­ã€‚

| é’©å­ç±»å‹           | é’©å­åç§°           | è§¦å‘æ—¶æœº                                                                                           | é’©å­å‚æ•°                  | å¯ä¸­æ­¢ |
| ]]></summary>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[Enzymeå®˜æ–¹APIä¸€è§ˆ]]></title>
        <id>https://jiangwenyang.com/posts/Enzymeå®˜æ–¹APIä¸€è§ˆ</id>
        <link href="https://jiangwenyang.com/posts/Enzymeå®˜æ–¹APIä¸€è§ˆ"/>
        <updated>2017-12-27T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ–­è¨€åº“Chai-expect-APIä¸€è§ˆ]]></title>
        <id>https://jiangwenyang.com/posts/Chai-expect APIä¸€è§ˆ</id>
        <link href="https://jiangwenyang.com/posts/Chai-expect APIä¸€è§ˆ"/>
        <updated>2017-12-20T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[Reactäº‹ä»¶ç»‘å®š]]></title>
        <id>https://jiangwenyang.com/posts/Reactäº‹ä»¶ç»‘å®š</id>
        <link href="https://jiangwenyang.com/posts/Reactäº‹ä»¶ç»‘å®š"/>
        <updated>2017-12-20T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[Reacté«˜ä»·ç»„ä»¶ï¼ˆHOCï¼‰]]></title>
        <id>https://jiangwenyang.com/posts/Reacté«˜ä»·ç»„ä»¶ï¼ˆHOCï¼‰</id>
        <link href="https://jiangwenyang.com/posts/Reacté«˜ä»·ç»„ä»¶ï¼ˆHOCï¼‰"/>
        <updated>2017-12-20T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[karma+karma-webpackå‰ç«¯å•å…ƒæµ‹è¯•]]></title>
        <id>https://jiangwenyang.com/posts/karma-karma-webpackå‰ç«¯å•å…ƒæµ‹è¯•</id>
        <link href="https://jiangwenyang.com/posts/karma-karma-webpackå‰ç«¯å•å…ƒæµ‹è¯•"/>
        <updated>2017-12-20T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mongooseå®˜æ–¹APIä¸€è§ˆ]]></title>
        <id>https://jiangwenyang.com/posts/Mongooseå®˜æ–¹APIä¸€è§ˆ</id>
        <link href="https://jiangwenyang.com/posts/Mongooseå®˜æ–¹APIä¸€è§ˆ"/>
        <updated>2017-04-16T11:30:16.000Z</updated>
        <summary type="html"><![CDATA[
## ç®€å•èµ·æ­¥

### ä¸€ã€å®‰è£…

ä½¿ç”¨ npm å®‰è£… mongooseï¼Œåœ¨è¿™ä¹‹å‰åº”è¯¥å®‰è£…é…ç½®å¥½ mongoDBï¼Œå…·ä½“å®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒ MongoDB å®˜æ–¹å®‰è£…æŒ‡å¯¼ã€‚

```shell
npm install mongoose
```

### äºŒã€è¿æ¥æ•°æ®åº“

é¢„è¿æ¥ï¼ˆmongoose ç›‘å¬æ•°æ®åº“ç«¯å£ï¼Œå°è¯•è¿›è¡Œè¿æ¥ï¼‰åˆ°é»˜è®¤çš„*localhost*çš„*test*æ•°æ®åº“ã€‚

```javascript
var mongoose = require("mongoose");
mongoose.connect("mongodb://localhost/test"); //mongoDBçš„æ•°æ®åº“è¿æ¥éƒ½æ˜¯ä»¥mongodb://æ‰“å¤´ï¼Œåé¢è·Ÿæ•°æ®åº“è·¯å¾„
```

### ä¸‰ã€åˆ¤æ–­æ˜¯å¦æˆåŠŸè¿æ¥æ•°æ®åº“

å‰é¢å·²ç»è¿›è¡Œæ•°æ®åº“çš„é¢„è¿æ¥ï¼Œåœ¨æ•°æ®åº“å¼€å¯æˆåŠŸï¼Œè¿æ¥è·¯å¾„æ²¡æœ‰é—®é¢˜çš„æƒ…å†µä¸‹ä¸€èˆ¬å°±èƒ½æ­£å¸¸è¿æ¥äº†ã€‚

```javascript
var db = mongoose.connection;
db.on(error, console.error.bind(console, "connection error:"));
db.once("open", function (callback) {
  // è¿æ¥æˆåŠŸï¼Œåç»­æ•°æ®åº“æ“ä½œéƒ½åœ¨å›è°ƒä¸­è¿›è¡Œ
});
```

### å››ã€å®šä¹‰æ¨¡å¼

æ¨¡å¼æ˜¯ mongoose çš„æ ¸å¿ƒï¼Œç›¸å½“äº SQL çš„æ•°æ®è¡¨ç»“æ„ï¼Œåœ¨è¿™é‡Œå®šä¹‰æ–‡æ¡£çš„é”®ä»¥åŠå¯¹åº”çš„å€¼çš„ç±»å‹ï¼Œä»¥åŠå®šä¹‰æ–‡æ¡£çš„å®ä¾‹æ–¹æ³•å’Œæ¨¡å‹çš„é™æ€æ–¹æ³•ã€‚

```javascript
var Schema = mongoose.Schema;
var UserSchema = new Schema({
  name: String,
  age: Number,
});
```

å€¼å¯¹åº”çš„ç±»å‹æ˜¯ SchemaTypeï¼Œå¯ç”¨çš„æœ‰ï¼š

- String
- Number
- Date
- Buffer
- Boolean
- Mixed
- ObjectId
- Array

### äº”ã€å¯¼å‡ºæ¨¡å‹

çœŸæ­£èƒ½å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œçš„æ˜¯æ¨¡å‹å’Œæ–‡æ¡£ï¼Œæ¨¡å‹æ˜¯æˆ‘ä»¬æ„å»ºæ–‡æ¡£çš„ç±»ï¼Œæ–‡æ¡£æ˜¯æ¨¡å‹çš„å®ä¾‹ï¼Œæ–‡æ¡£çš„é¢—ç²’åº¦æ¯”æ–‡æ¡£æ›´å°ã€‚

```javascript
var Model = mongoose.model;
var user = new Model("user", UserSchema);
```

### å…­ã€ç”Ÿæˆæ–‡æ¡£

æ–‡æ¡£ç›¸å½“äº SQL ä¸­çš„ä¸€è¡Œï¼Œæ˜¯çœŸæ­£å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚

```javascript
var tom = new user({
  name: "tom",
  age: 20,
});
```

### ä¸ƒã€å°†æ–‡æ¡£ä¿å­˜åˆ°æ•°æ®åº“

åœ¨ä¸Šä¸€æ­¥æˆ‘ä»¬ä»ç„¶æ²¡æœ‰åœ¨æ•°æ®åº“ä¸­ä¿å­˜ä»»ä½•æ•°æ®ï¼Œåªæ˜¯ç”Ÿæˆäº†æ–‡æ¡£ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å­˜å…¥æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨æ–‡æ¡£ä¸Š*saveï¼ˆï¼‰*æ–¹æ³•å°†ç”Ÿæˆçš„æ–‡æ¡£å­˜å…¥æ•°æ®åº“ã€‚

```javascript
tom.save(function (err, tom) {
  if (err) return console.error(err);
  //è¿›è¡Œå…¶ä»–æ“ä½œ
});
```

### å…«ã€æŸ¥è¯¢æ•°æ®åº“

æŸ¥è¯¢æ•°æ®åº“æ–‡æ¡£ï¼Œé€šè¿‡åœ¨*model*ä¸Šä½¿ç”¨*find*æ–¹æ³•ã€‚

```javascript
user.find({ name: "tom" }, function (err, doc) {
  console.log(doc);
});
```

_å¦‚æœä¸ä¼ å…¥æŸ¥è¯¢æ¡ä»¶å°†ä¼šæŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£_

]]></summary>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[windowsä¸‹git sshé…ç½®]]></title>
        <id>https://jiangwenyang.com/posts/git-sshé…ç½®</id>
        <link href="https://jiangwenyang.com/posts/git-sshé…ç½®"/>
        <updated>2016-05-30T18:58:33.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
    <entry>
        <title type="html"><![CDATA[MongoDBå…¥é—¨]]></title>
        <id>https://jiangwenyang.com/posts/MongoDBå…¥é—¨</id>
        <link href="https://jiangwenyang.com/posts/MongoDBå…¥é—¨"/>
        <updated>2016-05-13T00:00:00.000Z</updated>
        <author>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </author>
        <contributor>
            <name>Jiang Wenyang</name>
            <email>u19950930@gmail.com</email>
            <uri>https://jiangwenyang.com</uri>
        </contributor>
    </entry>
</feed>